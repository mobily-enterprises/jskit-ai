LOG_LEVEL=
DB_HOST=127.0.0.1
DB_PORT=3306
DB_NAME=material-app
DB_TEST_NAME=material-app_test
DB_USER=annuity_app
DB_PASSWORD=replace-with-a-strong-password

SUPABASE_URL=https://YOUR-PROJECT.supabase.co
SUPABASE_PUBLISHABLE_KEY=YOUR_SUPABASE_PUBLISHABLE_KEY
SUPABASE_JWT_AUDIENCE=authenticated
# Public app origin used to build password reset redirect: <APP_PUBLIC_URL>/reset-password
# Example (dev): http://localhost:5173
APP_PUBLIC_URL=
# SMS delivery mode: none (default) or plivo
SMS_DRIVER=none
# Required when SMS_DRIVER=plivo
PLIVO_AUTH_ID=
PLIVO_AUTH_TOKEN=
PLIVO_SOURCE_NUMBER=
# Rate limit backend mode: memory (default) or redis (shared store)
# Production requires redis mode.
RATE_LIMIT_MODE=memory
# Required when RATE_LIMIT_MODE=redis
REDIS_URL=
# BullMQ worker process concurrency (used by `npm run worker`)
WORKER_CONCURRENCY=2
# Maximum auto-requeue cycles for terminal lock-held failures before DLQ fallback
WORKER_LOCK_HELD_REQUEUE_MAX=3
# Retention sweep distributed lock TTL (milliseconds)
WORKER_RETENTION_LOCK_TTL_MS=1800000
# Enable when running behind a trusted reverse proxy/load balancer
TRUST_PROXY=false
# Prometheus metrics endpoint toggle.
METRICS_ENABLED=true
# Optional bearer token required for GET /api/metrics
METRICS_BEARER_TOKEN=
# AI assistant integration toggle. When false, AI chat route returns not found.
AI_ENABLED=false
# AI provider id (currently only openai is supported)
AI_PROVIDER=openai
# AI provider API key. Required when AI_ENABLED=true.
AI_API_KEY=
# Optional base URL for OpenAI-compatible providers.
AI_BASE_URL=
# Chat model used for workspace assistant turns.
AI_MODEL=gpt-4.1-mini
# Provider request timeout (milliseconds) per chat turn request.
AI_TIMEOUT_MS=45000
# Maximum chars accepted from a single user input message.
AI_MAX_INPUT_CHARS=8000
# Maximum prior chat messages from client history included in a turn.
AI_MAX_HISTORY_MESSAGES=20
# Maximum tool-call rounds allowed for one assistant turn.
AI_MAX_TOOL_CALLS_PER_TURN=4
# Optional workspace permission required to use AI chat at all (blank = any authenticated workspace member).
# Enforced in route auth pre-handler; denied requests return 403 before streaming starts.
# Must match a non-owner permission ID declared in RBAC manifest at startup.
AI_REQUIRED_PERMISSION=
# Billing + Stripe integration toggle.
BILLING_ENABLED=false
# Billing provider id (Phase 1 only supports stripe).
BILLING_PROVIDER=stripe
# Deployment billing currency (Phase 1 single-currency mode).
BILLING_CURRENCY=USD
# HMAC secret used to derive deterministic billing operation keys.
BILLING_OPERATION_KEY_SECRET=
# HMAC secret used to derive provider idempotency keys.
BILLING_PROVIDER_IDEMPOTENCY_KEY_SECRET=
# Stripe API secret key. Required when BILLING_ENABLED=true.
BILLING_STRIPE_SECRET_KEY=
# Stripe API version used by the official Stripe SDK. Required when BILLING_ENABLED=true.
BILLING_STRIPE_API_VERSION=
# Stripe webhook endpoint signing secret.
BILLING_STRIPE_WEBHOOK_ENDPOINT_SECRET=
# Stripe SDK network retry and timeout configuration.
BILLING_STRIPE_MAX_NETWORK_RETRIES=2
BILLING_STRIPE_TIMEOUT_MS=30000
# Billing checkout/idempotency recovery timing controls.
BILLING_PROVIDER_IDEMPOTENCY_REPLAY_WINDOW_SECONDS=82800
BILLING_CHECKOUT_PROVIDER_EXPIRES_SECONDS=86400
BILLING_CHECKOUT_SESSION_EXPIRES_AT_GRACE_SECONDS=90
BILLING_CHECKOUT_PENDING_LEASE_SECONDS=120
BILLING_CHECKOUT_COMPLETION_SLA_SECONDS=300
# Billing retention sweep controls.
BILLING_IDEMPOTENCY_RETENTION_DAYS=30
BILLING_WEBHOOK_PAYLOAD_RETENTION_DAYS=30
# Billing worker retry controls.
BILLING_OUTBOX_RETRY_DELAY_SECONDS=60
BILLING_OUTBOX_MAX_ATTEMPTS=8
BILLING_REMEDIATION_RETRY_DELAY_SECONDS=120
BILLING_REMEDIATION_MAX_ATTEMPTS=6

# Workspace tenancy profile: personal, team-single, multi-workspace
TENANCY_MODE=personal
# Defaults used by bootstrap + workspace policy
WORKSPACE_SWITCHING_DEFAULT=false
WORKSPACE_INVITES_DEFAULT=false
WORKSPACE_CREATE_ENABLED=false
MAX_WORKSPACES_PER_USER=1
# Relative paths resolve from project root.
RBAC_MANIFEST_PATH=./shared/auth/rbac.manifest.json
# Frontend static directory served by server.js (relative to project root or absolute path)
FRONTEND_DIST_DIR=dist

# Avatar storage (default local filesystem via unstorage fs driver)
AVATAR_STORAGE_DRIVER=fs
# Example: /absolute/path/to/app-data/storage
AVATAR_STORAGE_FS_BASE_PATH=
# Public URL prefix where avatar files are served
AVATAR_PUBLIC_BASE_PATH=/uploads
# Workspace invite email delivery mode: none (default) or smtp
WORKSPACE_INVITE_EMAIL_DRIVER=none
# SMTP settings used when WORKSPACE_INVITE_EMAIL_DRIVER=smtp
SMTP_HOST=
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USERNAME=
SMTP_PASSWORD=
SMTP_FROM=
# Retention sweep defaults (used by `npm run ops:retention`)
ERROR_LOG_RETENTION_DAYS=30
INVITE_ARTIFACT_RETENTION_DAYS=90
SECURITY_AUDIT_RETENTION_DAYS=365
AI_TRANSCRIPTS_RETENTION_DAYS=60
RETENTION_BATCH_SIZE=1000
# Frontend navigation drawer mode on desktop: "collapsible" (default) or "permanent"
VITE_DESKTOP_DRAWER_BEHAVIOR=collapsible
